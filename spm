#!/bin/bash

# Simple Package Manager (SPM)
# Usage: sudo spm add <package>

REPO_BASE="https://raw.githubusercontent.com/Darkwing14/Small-Package-Manager/main"
INSTALL_DIR="/usr/local/bin"

# Ensure curl is available
command -v curl >/dev/null 2>&1 || {
    echo "Error: curl is required but not installed."
    exit 1
}

# Ensure running as root
if [[ $EUID -ne 0 ]]; then
    echo "Please run as root (e.g., sudo spm add <package>)"
    exit 1
fi

case "$1" in
    add)
        PACKAGE="$2"
        if [[ -z "$PACKAGE" ]]; then
            echo "Usage: sudo spm add <package>"
            exit 1
        fi

        echo "Downloading package: $PACKAGE"
        curl -fsSL "$REPO_BASE/$PACKAGE" -o "$INSTALL_DIR/$PACKAGE" || {
            echo "Failed to download package: $PACKAGE"
            exit 1
        }

        echo "Installing package: $PACKAGE"
        chmod +x "$INSTALL_DIR/$PACKAGE"
        echo "Installed $PACKAGE to $INSTALL_DIR"
        ;;
    update)
        spm add spm
        ;;
    version)
        echo "1.1"
        ;;
    trash)
        if [[ -f "$INSTALL_DIR/$2" ]]; then
            rm -i "$INSTALL_DIR/$2"
        else
            echo "Package '$2' not found in $INSTALL_DIR"
        fi
        ;;
    reinstall)
        spm trash $2
        spm add $2
        ;;
    deb)
        PACKAGE="$2"
        if [[ -z "$PACKAGE" ]]; then
            echo "Usage: sudo spm deb <package>"
            exit 1
        fi

        echo "Downloading package: $PACKAGE"
        curl -fsSL "$REPO_BASE/$PACKAGE.deb" -o "/tmp/$PACKAGE.deb" || {
            echo "Failed to download package: $PACKAGE"
            exit 1
        }
        echo "Installing package: $PACKAGE"
        dpkg -i "/tmp/$PACKAGE.deb"
        echo "Installed $PACKAGE using dpkg"
        ;;
    *)
        echo "Unknown command: $1"
        echo "Usage: sudo spm <add (package)|update|version|trash (package)|reinstall (package)>"
        exit 1
        ;;
esac
